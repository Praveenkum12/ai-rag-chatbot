<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - AI RAG Chatbot</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
        background: radial-gradient(
          circle at top right,
          #1e1b4b,
          #0f172a,
          #020617
        );
        color: #f8fafc;
      }
      .glass {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .btn-gradient {
        background: linear-gradient(135deg, #6366f1, #a855f7);
      }
    </style>
  </head>
  <body class="min-h-screen flex items-center justify-center p-6">
    <div
      class="max-w-md w-full glass p-10 rounded-3xl shadow-2xl relative overflow-hidden"
    >
      <!-- Floating shapes -->
      <div
        class="absolute -top-10 -right-10 w-32 h-32 bg-indigo-500/10 rounded-full blur-3xl"
      ></div>
      <div
        class="absolute -bottom-10 -left-10 w-32 h-32 bg-purple-500/10 rounded-full blur-3xl"
      ></div>

      <div class="text-center mb-8">
        <div
          class="w-16 h-16 btn-gradient rounded-2xl flex items-center justify-center mx-auto mb-4 shadow-lg shadow-indigo-500/20"
        >
          <i data-lucide="bot" class="text-white w-8 h-8"></i>
        </div>
        <h1 class="text-3xl font-bold font-outfit mb-2">Welcome Back</h1>
        <p class="text-slate-400 text-sm" id="authSubtitle">
          Please enter your details to sign in
        </p>
      </div>

      <form id="authForm" class="space-y-6">
        <div id="nameGroup" class="hidden">
          <label
            class="text-xs font-semibold text-slate-500 uppercase tracking-widest ml-1 mb-2 block"
            >Full Name</label
          >
          <div class="relative">
            <i
              data-lucide="user"
              class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"
            ></i>
            <input
              type="text"
              id="fullname"
              class="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-indigo-500/50 outline-none transition-all placeholder:text-slate-600"
              placeholder="John Doe"
            />
          </div>
        </div>

        <div id="emailGroup">
          <label
            class="text-xs font-semibold text-slate-500 uppercase tracking-widest ml-1 mb-2 block"
            >Email Address</label
          >
          <div class="relative">
            <i
              data-lucide="mail"
              class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"
            ></i>
            <input
              type="email"
              id="email"
              required
              class="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-indigo-500/50 outline-none transition-all placeholder:text-slate-600"
              placeholder="name@example.com"
            />
          </div>
        </div>

        <div id="phoneGroup" class="hidden">
          <label
            class="text-xs font-semibold text-slate-500 uppercase tracking-widest ml-1 mb-2 block"
            >Phone Number</label
          >
          <div class="relative">
            <i
              data-lucide="phone"
              class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"
            ></i>
            <input
              type="text"
              id="phone"
              class="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-indigo-500/50 outline-none transition-all placeholder:text-slate-600"
              placeholder="+1 (555) 000-0000"
            />
          </div>
        </div>

        <div>
          <label
            class="text-xs font-semibold text-slate-500 uppercase tracking-widest ml-1 mb-2 block"
            >Password</label
          >
          <div class="relative">
            <i
              data-lucide="lock"
              class="absolute left-4 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"
            ></i>
            <input
              type="password"
              id="password"
              required
              class="w-full bg-white/5 border border-white/10 rounded-xl py-3 pl-12 pr-4 focus:ring-2 focus:ring-indigo-500/50 outline-none transition-all placeholder:text-slate-600"
              placeholder="••••••••"
            />
          </div>
        </div>

        <button
          type="submit"
          id="submitBtn"
          class="w-full btn-gradient py-4 rounded-xl font-bold text-lg shadow-lg shadow-indigo-500/20 hover:scale-[1.02] active:scale-[0.98] transition-all"
        >
          Sign In
        </button>
      </form>

      <p class="text-center mt-8 text-sm text-slate-400">
        <span id="toggleText">Don't have an account?</span>
        <button
          onclick="toggleAuthMode()"
          class="text-indigo-400 font-bold hover:text-indigo-300 ml-1 underline decoration-indigo-500/30 underline-offset-4"
          id="toggleLink"
        >
          Sign Up
        </button>
      </p>

      <div
        id="errorMsg"
        class="mt-4 p-3 bg-red-500/10 border border-red-500/20 rounded-xl text-red-400 text-center text-sm hidden animate-shake"
      ></div>
    </div>

    <script>
      // Clear any existing session data on entry
      localStorage.clear();

      lucide.createIcons();
      let isSignUp = false;

      function toggleAuthMode() {
        isSignUp = !isSignUp;
        document.title = isSignUp
          ? "Sign Up - AI RAG Chatbot"
          : "Login - AI RAG Chatbot";
        document.querySelector("h1").textContent = isSignUp
          ? "Create Account"
          : "Welcome Back";
        document.getElementById("authSubtitle").textContent = isSignUp
          ? "Fill in the details to get started"
          : "Please enter your details to sign in";
        document.getElementById("submitBtn").textContent = isSignUp
          ? "Create Account"
          : "Sign In";
        document.getElementById("toggleText").textContent = isSignUp
          ? "Already have an account?"
          : "Don't have an account?";
        document.getElementById("toggleLink").textContent = isSignUp
          ? "Sign In"
          : "Sign Up";
        document
          .getElementById("phoneGroup")
          .classList.toggle("hidden", !isSignUp);
        document
          .getElementById("nameGroup")
          .classList.toggle("hidden", !isSignUp);
        document.getElementById("errorMsg").classList.add("hidden");
      }

      document
        .getElementById("authForm")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          const phone = document.getElementById("phone").value;
          const full_name = document.getElementById("fullname").value;
          const errorMsg = document.getElementById("errorMsg");
          const btn = document.getElementById("submitBtn");

          errorMsg.classList.add("hidden");
          btn.disabled = true;
          btn.textContent = isSignUp ? "Creating..." : "Signing In...";

          try {
            const url = isSignUp ? "/auth/register" : "/auth/login";
            const body = isSignUp
              ? { email, password, phone, full_name }
              : { email, password };

            const res = await fetch(url, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(body),
            });

            const data = await res.json();

            if (res.ok) {
              if (isSignUp) {
                alert("Account created! Please sign in.");
                toggleAuthMode();
              } else {
                localStorage.setItem("token", data.access_token);
                localStorage.setItem("user", JSON.stringify(data.user));
                window.location.href = "/";
              }
            } else {
              errorMsg.textContent = data.detail || "Something went wrong";
              errorMsg.classList.remove("hidden");
            }
          } catch (err) {
            errorMsg.textContent = "Connection error";
            errorMsg.classList.remove("hidden");
          } finally {
            btn.disabled = false;
            btn.textContent = isSignUp ? "Create Account" : "Sign In";
          }
        });
    </script>
  </body>
</html>
